<!DOCTYPE html>
<html lang="km">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ការគ្រប់គ្រងអ្នកប្រើប្រាស់ - ប្រព័ន្ធគ្រប់គ្រងសាលា</title>
    <link rel="icon" type="image/jpeg" href="img/1.jpg">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />

    <!-- Font Awesome 6 (ផ្លាស់ប្តូរទៅកំណែថ្មី) -->
    <link rel="preload" href="https://cdn-uicons.flaticon.com/uicons-regular-rounded/css/uicons-regular-rounded.css"
        as="style">
    <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/uicons-regular-rounded/css/uicons-regular-rounded.css'>
    <link rel="stylesheet" href="loader.css">
    <script src="loader-init.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Battambang:wght@400;700&family=Moul&display=swap"
        rel="stylesheet">
    <style>
        /* --- FONTS --- */
        @font-face {
            font-family: 'Khmer OS Battambang';
            src: url('fonts/KhmerOSBattambang.woff2') format('woff2'),
                url('fonts/KhmerOSBattambang.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }

        @font-face {
            font-family: 'Khmer OS Battambang';
            src: url('fonts/KhmerOSBattambang.ttf') format('truetype');
            font-weight: bold;
            font-style: normal;
            font-display: swap;
        }

        body {
            font-family: 'Khmer OS Battambang', 'Arial', sans-serif;
            background-color: #f8f9fa;
        }

        .title-font {
            font-family: 'Moul', cursive;
        }

        /* --- SIDEBAR STYLES (MATCHING INDEX.HTML) --- */
        #sidebar {
            width: 250px;
            min-width: 250px;
            background: #8a0e5b;
            color: white;
            padding: 0;
            box-shadow: 3px 0 15px rgba(0, 0, 0, 0.15);
            flex-shrink: 0;
            position: sticky;
            top: 0;
            height: 100vh;
            z-index: 100;
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            padding: 15px;
            background: #8a0e5b;
            font-weight: bold;
            font-size: 1.1rem;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
        }

        #sidebar-logo {
            width: 45px;
            height: 45px;
            margin-right: 10px;
            object-fit: cover;
            background: white;
            padding: 4px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        #sidebar .nav {
            padding-top: 10px;
        }

        #sidebar .nav-link {
            color: rgba(255, 255, 255, 0.9) !important;
            padding: 12px 20px;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
            display: flex;
            align-items: center;
            text-decoration: none;
        }

        #sidebar .nav-link i {
            margin-right: 10px;
            width: 25px;
            text-align: center;
        }

        #sidebar .nav-link:hover {
            background: rgba(255, 255, 255, 0.1) !important;
            color: white !important;
            border-left-color: #8a0e5b;
            padding-left: 25px;
        }

        #sidebar .nav-link.active {
            background: linear-gradient(90deg, #ff69b4, rgba(255, 105, 180, 0.8)) !important;
            color: white !important;
            font-weight: bold;
            border-left-color: white;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        /* --- MAIN CONTENT & CARDS --- */
        .card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s;
            border: none !important;
            border-radius: 15px !important;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
        }

        .card-header {
            background-color: white;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            border-radius: 15px 15px 0 0 !important;
            padding: 15px 20px;
        }

        .text-primary {
            color: #8a0e5b !important;
            /* Update to match theme */
        }

        /* --- PERMISSION CARDS (CUSTOM) --- */
        .permission-card {
            border: 1px solid #eef2f7;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            background-color: #ffffff;
            transition: all 0.3s ease;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.02);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            height: 100%;
        }

        .permission-card:hover {
            border-color: #8a0e5b;
            background-color: #fff0f5;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 105, 180, 0.15);
        }

        /* --- SIDEBAR HEADER (MATCHING INDEX.HTML) --- */
        .sidebar-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px 15px;
            background: #8a0e5b;
            font-weight: bold;
            font-size: 1.1rem;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
            text-align: center;
        }

        #sidebar-logo {
            width: 70px;
            height: 70px;
            margin-right: 0;
            margin-bottom: 10px;
            object-fit: cover;
            padding: 0;
            border-radius: 50%;
        }

        .sidebar-title-text {
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }

        .permission-card .form-check-input {
            cursor: pointer;
            width: 3em;
            height: 1.5em;
        }

        .permission-card .form-check-label {
            cursor: pointer;
            font-size: 1.05rem;
            color: #2c3e50;
            margin-top: 5px;
            display: inline-block;
        }

        .form-check-input:checked {
            background-color: #ff69b4;
            border-color: #ff69b4;
        }

        /* --- FORMS & BUTTONS --- */
        .form-control {
            border-radius: 10px;
            padding: 12px 15px;
            border: 1px solid #e0e0e0;
            background-color: #f8f9fa;
        }

        .form-control:focus {
            background-color: #fff;
            box-shadow: 0 0 0 4px rgba(255, 105, 180, 0.15);
            border-color: #ff69b4;
        }

        .btn-success {
            background: linear-gradient(135deg, #ff69b4, #c71585) !important;
            border: none;
            box-shadow: 0 4px 10px rgba(199, 21, 133, 0.3);
            transition: all 0.3s;
            padding: 10px 20px;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(199, 21, 133, 0.4);
            filter: brightness(1.1);
        }

        /* --- TABLE STYLES --- */
        .table {
            margin-bottom: 0;
        }

        .table thead th {
            font-weight: 600;
            color: #666;
            background-color: #f8f9fa;
            border-bottom: 2px solid #eef2f7;
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 0.5px;
        }

        .table-hover tbody tr:hover {
            background-color: #fff0f5;
        }

        .badge {
            padding: 8px 12px;
            font-weight: 500;
            border-radius: 6px;
        }

        .header-container {
            background: white;
            border-radius: 15px;
            padding: 20px 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 6px solid var(--bs-pink-dark);
        }

        .header-title-text {
            color: var(--bs-pink-dark);
            font-weight: bold;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header-breadcrumb {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
            color: #6c757d;
        }

        .header-breadcrumb a {
            color: var(--bs-pink-primary);
            text-decoration: none;
            transition: color 0.3s;
        }

        .header-breadcrumb a:hover {
            color: var(--bs-pink-dark);
        }

        /* --- NEW UTILITIES --- */
        :root {
            --bs-pink-primary: #ff69b4;
            --bs-pink-dark: #c71585;
            --bs-pink-light: #fff0f5;
        }

        .text-pink-dark {
            color: var(--bs-pink-dark) !important;
        }

        .bg-pink-light {
            background-color: var(--bs-pink-light) !important;
        }

        .bg-gradient-pink {
            background: linear-gradient(135deg, #ff69b4, #c71585) !important;
        }

        .font-size-xs {
            font-size: 0.75rem;
            letter-spacing: 0.05em;
        }

        .pointer-events-none {
            pointer-events: none;
        }

        .hover-shadow-sm:hover {
            box-shadow: 0 .125rem .25rem rgba(0, 0, 0, .075) !important;
            transform: translateY(-1px);
        }

        .transition-all {
            transition: all 0.2s ease-in-out;
        }
    </style>
</head>

<body class="bg-light">
    <div class="d-flex" id="wrapper">
        <!-- Sidebar -->
        <div id="sidebar">
            <div class="sidebar-header">
                <a href="index.html">
                    <img src="img/1.jpg" alt="School Logo" id="sidebar-logo">
                </a>
            </div>

            <nav class="nav flex-column">
                <a class="nav-link" href="index.html">
                    <i class="fi fi-rr-apps"></i> ផ្ទាំងគ្រប់គ្រង
                </a>
                <a class="nav-link" href="registration.html">
                    <i class="fi fi-rr-user-add"></i> ការចុះឈ្មោះសិស្ស
                </a>

                <a class="nav-link" href="data-tracking.html">
                    <i class="fi fi-rr-users-alt"></i> បញ្ជីទិន្នន័យសិស្ស
                </a>

                <a class="nav-link" href="income-expense.html">
                    <i class="fi fi-rr-receipt"></i> ចំណូលចំណាយ
                </a>
                <a class="nav-link" href="inventory.html">
                    <i class="fi fi-rr-box-alt"></i> ស្តុកសម្ភារៈ
                </a>
                <a class="nav-link active" href="user-management.html">
                    <i class="fi fi-rr-shield-check"></i> គ្រប់គ្រងអ្នកប្រើប្រាស់
                </a>
                <a class="nav-link" href="dropout-students.html" id="nav-dropout">
                    <i class="fi fi-rr-user-remove"></i> សិស្សបោះបង់ការសិក្សា
                </a>
                <a class="nav-link" href="student-card.html">
                    <i class="fi fi-rr-id-badge"></i> មុខងារបង្កើតកាតសិស្ស
                </a>
            </nav>

            <hr class="sidebar-divider my-2 mx-3" style="border-top: 1px solid rgba(255,255,255,0.3);">

            <!-- User Profile Section -->
            <div class="px-3 py-3 text-white border-top border-bottom border-white-10"
                style="background: rgba(0,0,0,0.05);">
                <div class="text-center">
                    <div class="bg-white rounded-circle d-inline-flex align-items-center justify-content-center mb-2 shadow-sm"
                        style="width: 50px; height: 50px;">
                        <i class="fi fi-rr-user-circle text-primary fa-2x"></i>
                    </div>
                    <div style="font-size: 0.85rem;">
                        <div class="fw-bold text-truncate mb-1" id="user-display-name" style="font-size: 1rem;">...
                        </div>
                        <div class="text-white-50 text-truncate mb-2" id="user-display-email"
                            style="font-size: 0.75rem;">...</div>
                        <div class="badge bg-warning text-dark fw-normal" id="user-role-badge">...</div>
                    </div>
                </div>
            </div>

            <a href="#" class="nav-link text-warning mt-1" onclick="handleLogout(event)">
                <i class="fi fi-rr-sign-out-alt"></i> ចាកចេញ
            </a>
        </div>

        <!-- Check Auth & Main Content -->
        <script>
            // Simple inline check to ensure only admin sees this page quickly
            // Real protection is in auth-check.js
        </script>

        <!-- Page Content -->
        <div id="page-content-wrapper" class="w-100 p-4">
            <div class="header-container animate__animated animate__fadeIn">
                <div class="d-flex align-items-center">
                    <div class="header-title-text">
                        <div class="bg-pink-light rounded-circle p-2 d-inline-flex me-2 shadow-sm"
                            style="background: #fff0f5;">
                            <i class="fi fi-rr-shield-check fa-lg" style="color: #c71585;"></i>
                        </div>
                        <h2 class="fs-3 m-0 title-font">ការគ្រប់គ្រងអ្នកប្រើប្រាស់ (User Management)</h2>
                    </div>
                </div>
                <div class="header-breadcrumb">
                    <i class="fi fi-rr-home"></i>
                    <a href="index.html">ផ្ទាំងគ្រប់គ្រង</a>
                    <i class="fi fi-rr-angle-right small"></i>
                    <span class="active text-pink-dark fw-bold">គ្រប់គ្រងអ្នកប្រើប្រាស់</span>
                </div>
            </div>

            <!-- Control Bar -->
            <div class="row mb-4 align-items-center animate__animated animate__fadeInUp">
                <div class="col-md-6">
                    <div class="input-group shadow-sm" style="border-radius: 12px; overflow: hidden;">
                        <span class="input-group-text bg-white border-0 ps-3 text-muted">
                            <i class="fi fi-rr-search"></i>
                        </span>
                        <input type="text" id="searchInput" class="form-control border-0 py-3"
                            placeholder="ស្វែងរកតាមឈ្មោះ ឬអ៊ីមែល (Search)..." onkeyup="filterUsers()">
                    </div>
                </div>
                <div class="col-md-6 text-md-end mt-3 mt-md-0">
                    <button class="btn btn-success px-4 py-2 fw-bold shadow-sm rounded-pill" data-bs-toggle="modal"
                        data-bs-target="#addUserModal">
                        <i class="fi fi-rr-user-add me-2"></i>បង្កើតអ្នកប្រើប្រាស់ថ្មី
                    </button>
                </div>
            </div>

            <!-- Users List -->
            <div class="card shadow-sm border-0 animate__animated animate__fadeInUp"
                style="border-radius: 15px; animation-delay: 0.1s;">
                <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                    <h5 class="mb-0 fw-bold text-pink-dark"><i class="fi fi-rr-users me-2"></i>បញ្ជីអ្នកប្រើប្រាស់</h5>
                    <span class="badge bg-pink-light text-pink-dark" id="userCountBadge">0 Users</span>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle mb-0" id="usersTable">
                            <thead class="bg-light">
                                <tr>
                                    <th class="py-3 ps-4 text-secondary text-uppercase font-size-xs">ឈ្មោះ (Name)</th>
                                    <th class="py-3 text-secondary text-uppercase font-size-xs">អ៊ីមែល (Email)</th>
                                    <th class="py-3 text-secondary text-uppercase font-size-xs">តួនាទី (Role)</th>
                                    <th class="py-3 text-secondary text-uppercase font-size-xs">សិទ្ធិប្រើប្រាស់
                                        (Permissions)</th>
                                    <th class="py-3 text-end pe-4 text-secondary text-uppercase font-size-xs">សកម្មភាព
                                        (Actions)</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody">
                                <!-- Data will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>

    <!-- Create User Modal -->
    <div class="modal fade" id="addUserModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg" style="border-radius: 20px; overflow: hidden;">
                <div class="modal-header text-white"
                    style="background-color: #8a0e5b; border-bottom: 2px solid rgba(255,255,255,0.1);">
                    <h5 class="modal-title fw-bold title-font"><i
                            class="fi fi-rr-user-add me-2"></i>បង្កើតអ្នកប្រើប្រាស់ថ្មី</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Close"></button>
                </div>
                <div class="modal-body p-4 bg-light">
                    <form id="createUserForm">
                        <div class="row g-4">
                            <!-- Basic Info -->
                            <div class="col-md-6">
                                <div class="bg-white p-4 rounded-4 shadow-sm h-100 border border-light">
                                    <h6
                                        class="fw-bold text-pink-dark mb-4 border-bottom pb-2 d-flex align-items-center">
                                        <div class="bg-pink-light rounded-circle p-2 me-2 d-flex justify-content-center align-items-center"
                                            style="width: 35px; height: 35px;">
                                            <i class="fi fi-rr-info text-pink-dark"></i>
                                        </div>
                                        ព័ត៌មានគណនី
                                    </h6>

                                    <div class="form-floating mb-3">
                                        <input type="text" class="form-control" id="newUserName" placeholder="Name"
                                            required style="border-radius: 10px;">
                                        <label for="newUserName">ឈ្មោះ (Name)</label>
                                    </div>

                                    <div class="form-floating mb-3">
                                        <input type="email" class="form-control" id="newUserEmail" placeholder="Email"
                                            required style="border-radius: 10px;">
                                        <label for="newUserEmail">អ៊ីមែល (Email)</label>
                                    </div>

                                    <div class="input-group mb-3">
                                        <div class="form-floating flex-grow-1">
                                            <input type="password" class="form-control" id="newUserPassword"
                                                placeholder="Password" required
                                                style="border-radius: 10px 0 0 10px; border-right: none;">
                                            <label for="newUserPassword">ពាក្យសម្ងាត់ (Password)</label>
                                        </div>
                                        <button class="btn btn-outline-secondary bg-white border-start-0" type="button"
                                            style="border-radius: 0 10px 10px 0; border-color: #ced4da;"
                                            onclick="togglePasswordVisibility('newUserPassword', this)">
                                            <i class="fi fi-rr-eye"></i>
                                        </button>
                                    </div>

                                    <div class="form-floating">
                                        <select class="form-select" id="newUserRole" placeholder="Role"
                                            style="border-radius: 10px;">
                                            <option value="staff" selected>បុគ្គលិក (Staff)</option>
                                            <option value="admin">អ្នកគ្រប់គ្រង (Admin)</option>
                                        </select>
                                        <label for="newUserRole">តួនាទី (Role)</label>
                                    </div>
                                </div>
                            </div>

                            <!-- Permissions -->
                            <div class="col-md-6">
                                <div class="bg-white p-4 rounded-4 shadow-sm h-100 border border-light">
                                    <h6
                                        class="fw-bold text-pink-dark mb-4 border-bottom pb-2 d-flex align-items-center">
                                        <div class="bg-pink-light rounded-circle p-2 me-2 d-flex justify-content-center align-items-center"
                                            style="width: 35px; height: 35px;">
                                            <i class="fi fi-rr-shield-check text-pink-dark"></i>
                                        </div>
                                        សិទ្ធិប្រើប្រាស់
                                    </h6>

                                    <p class="small text-muted mb-3">ជ្រើសរើសផ្នែកដែលអ្នកប្រើប្រាស់នេះអាចចូលបាន៖</p>

                                    <div class="d-flex flex-column gap-3">
                                        <!-- Horizontal Scroll Container for Permissions if needed, but vertical stack might be cleaner here given the column width. 
                                             However, adhering to previous request for Horizontal, let's keep it but improve styling. 
                                             Actually, inside a col-6, a vertical list is often better for readability. 
                                             But strictly following "Horizontal" from before? 
                                             Let's use a wrapping flex container that looks good. 
                                        -->

                                        <div class="d-flex flex-row gap-2 overflow-auto pb-2"
                                            style="scrollbar-width: thin;">
                                            <div class="permission-card p-3 border rounded-3 d-flex flex-column align-items-center justify-content-center text-center hover-shadow-sm transition-all flex-shrink-0"
                                                style="min-width: 110px; cursor: pointer; background: #fff;"
                                                onclick="document.getElementById('permDashboard').click()">
                                                <i class="fi fi-rr-apps text-primary fs-4 mb-2"></i>
                                                <span class="fw-bold text-dark small mb-2">Dashboard</span>
                                                <div class="form-check form-switch pointer-events-none">
                                                    <input class="form-check-input" type="checkbox" id="permDashboard">
                                                </div>
                                            </div>

                                            <div class="permission-card p-3 border rounded-3 d-flex flex-column align-items-center justify-content-center text-center hover-shadow-sm transition-all flex-shrink-0"
                                                style="min-width: 110px; cursor: pointer;"
                                                onclick="document.getElementById('permRegistration').click()">
                                                <i class="fi fi-rr-user-add text-success fs-4 mb-2"></i>
                                                <span class="fw-bold text-dark small mb-2">Registration</span>
                                                <div class="form-check form-switch pointer-events-none">
                                                    <input class="form-check-input" type="checkbox"
                                                        id="permRegistration" checked>
                                                </div>
                                            </div>

                                            <div class="permission-card p-3 border rounded-3 d-flex flex-column align-items-center justify-content-center text-center hover-shadow-sm transition-all flex-shrink-0"
                                                style="min-width: 110px; cursor: pointer;"
                                                onclick="document.getElementById('permData').click()">
                                                <i class="fi fi-rr-users-alt text-info fs-4 mb-2"></i>
                                                <span class="fw-bold text-dark small mb-2">Data List</span>
                                                <div class="form-check form-switch pointer-events-none">
                                                    <input class="form-check-input" type="checkbox" id="permData"
                                                        checked>
                                                </div>
                                            </div>

                                            <div class="permission-card p-3 border rounded-3 d-flex flex-column align-items-center justify-content-center text-center hover-shadow-sm transition-all flex-shrink-0"
                                                style="min-width: 110px; cursor: pointer;"
                                                onclick="document.getElementById('permInventory').click()">
                                                <i class="fi fi-rr-box-alt text-warning fs-4 mb-2"></i>
                                                <span class="fw-bold text-dark small mb-2">Inventory</span>
                                                <div class="form-check form-switch pointer-events-none">
                                                    <input class="form-check-input" type="checkbox" id="permInventory">
                                                </div>
                                            </div>

                                            <div class="permission-card p-3 border rounded-3 d-flex flex-column align-items-center justify-content-center text-center hover-shadow-sm transition-all flex-shrink-0"
                                                style="min-width: 110px; cursor: pointer;"
                                                onclick="document.getElementById('permIncomeExpense').click()">
                                                <i class="fi fi-rr-receipt text-danger fs-4 mb-2"></i>
                                                <span class="fw-bold text-dark small mb-2">Income/Exp</span>
                                                <div class="form-check form-switch pointer-events-none">
                                                    <input class="form-check-input" type="checkbox"
                                                        id="permIncomeExpense">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="text-muted small text-center mt-2">
                                            <i class="fi fi-rr-arrow-right me-1"></i> Scroll to see more
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="d-grid mt-4">
                            <button type="submit" class="btn text-white py-3 fw-bold shadow-sm"
                                style="background-color: #8a0e5b; border-radius: 12px; transition: all 0.3s;"
                                onmouseover="this.style.backgroundColor='#700b4a'"
                                onmouseout="this.style.backgroundColor='#8a0e5b'">
                                <i class="fi fi-rr-disk me-2"></i>បង្កើតគណនី (Create Account)
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    </div>
    </div>

    <!-- Edit User Modal -->
    <div class="modal fade" id="editUserModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow" style="border-radius: 15px;">
                <div class="modal-header bg-primary text-white" style="border-radius: 15px 15px 0 0;">
                    <h5 class="modal-title fw-bold title-font"><i
                            class="fi fi-rr-edit me-2"></i>កែប្រែសិទ្ធិអ្នកប្រើប្រាស់</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    <form id="editUserForm">
                        <input type="hidden" id="editUserUid">
                        <div class="mb-3">
                            <label class="form-label fw-bold"><i class="fi fi-rr-id-badge me-2 text-primary"></i>ឈ្មោះ
                                (Name):</label>
                            <input type="text" class="form-control" id="editUserName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label text-muted small"><i class="fi fi-rr-envelope me-2"></i>អ៊ីមែល
                                (Email):</label>
                            <input type="text" class="form-control bg-light" id="editUserEmail" readonly>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold"><i
                                    class="fi fi-rr-shield-check me-2 text-primary"></i>តួនាទី
                                (Role):</label>
                            <div class="input-group">
                                <select class="form-select form-control" id="editUserRole">
                                    <option value="staff">បុគ្គលិក (Staff)</option>
                                    <option value="admin">អ្នកគ្រប់គ្រង (Admin)</option>
                                </select>
                                <button class="btn btn-outline-primary" type="button"
                                    onclick="promptNewRole('editUserRole')">
                                    <i class="fi fi-rr-plus"></i>
                                </button>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold"><i
                                    class="fi fi-rr-key me-2 text-primary"></i>ប្ដូរពាក្យសម្ងាត់ថ្មី (Change
                                Password):</label>
                            <div class="input-group">
                                <input type="password" class="form-control" id="editUserPassword"
                                    placeholder="ទុកទំនេរប្រសិនបើមិនប្ដូរ">
                                <button class="btn btn-outline-secondary" type="button"
                                    onclick="togglePasswordVisibility('editUserPassword', this)">
                                    <i class="fi fi-rr-eye"></i>
                                </button>
                            </div>
                            <small class="text-danger small">* ការប្ដូរ Password អាចតម្រូវឱ្យ Logout</small>
                        </div>

                        <label class="form-label fw-bold mb-3 text-primary">កំណត់សិទ្ធិប្រើប្រាស់ថ្មី:</label>

                        <div class="d-flex flex-row gap-2 overflow-auto pb-2">
                            <div class="permission-card p-2 border rounded-3 d-flex align-items-center justify-content-between hover-shadow-sm transition-all"
                                style="min-width: 150px;"
                                onclick="document.getElementById('editPermDashboard').click()">
                                <div>
                                    <i class="fi fi-rr-apps text-primary me-2"></i>
                                    <span class="fw-bold text-dark small">Dashboard</span>
                                </div>
                                <div class="form-check form-switch pointer-events-none ms-2">
                                    <input class="form-check-input" type="checkbox" id="editPermDashboard">
                                </div>
                            </div>

                            <div class="permission-card p-2 border rounded-3 d-flex align-items-center justify-content-between hover-shadow-sm transition-all"
                                style="min-width: 150px;"
                                onclick="document.getElementById('editPermRegistration').click()">
                                <div>
                                    <i class="fi fi-rr-user-add text-success me-2"></i>
                                    <span class="fw-bold text-dark small">Registration</span>
                                </div>
                                <div class="form-check form-switch pointer-events-none ms-2">
                                    <input class="form-check-input" type="checkbox" id="editPermRegistration">
                                </div>
                            </div>

                            <div class="permission-card p-2 border rounded-3 d-flex align-items-center justify-content-between hover-shadow-sm transition-all"
                                style="min-width: 150px;" onclick="document.getElementById('editPermData').click()">
                                <div>
                                    <i class="fi fi-rr-users-alt text-info me-2"></i>
                                    <span class="fw-bold text-dark small">Data</span>
                                </div>
                                <div class="form-check form-switch pointer-events-none ms-2">
                                    <input class="form-check-input" type="checkbox" id="editPermData">
                                </div>
                            </div>

                            <div class="permission-card p-2 border rounded-3 d-flex align-items-center justify-content-between hover-shadow-sm transition-all"
                                style="min-width: 150px;"
                                onclick="document.getElementById('editPermInventory').click()">
                                <div>
                                    <i class="fi fi-rr-box-alt text-warning me-2"></i>
                                    <span class="fw-bold text-dark small">Inventory</span>
                                </div>
                                <div class="form-check form-switch pointer-events-none ms-2">
                                    <input class="form-check-input" type="checkbox" id="editPermInventory">
                                </div>
                            </div>

                            <div class="permission-card p-2 border rounded-3 d-flex align-items-center justify-content-between hover-shadow-sm transition-all"
                                style="min-width: 150px;"
                                onclick="document.getElementById('editPermIncomeExpense').click()">
                                <div>
                                    <i class="fi fi-rr-receipt text-danger me-2"></i>
                                    <span class="fw-bold text-dark small">Income/Exp</span>
                                </div>
                                <div class="form-check form-switch pointer-events-none ms-2">
                                    <input class="form-check-input" type="checkbox" id="editPermIncomeExpense">
                                </div>
                            </div>
                        </div>

                        <div class="d-grid mt-4">
                            <button type="submit" class="btn btn-success py-2 fw-bold shadow-sm">
                                <i class="fi fi-rr-disk me-2"></i>រក្សាទុកការផ្លាស់ប្តូរ
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <!-- Config & Scripts -->
    <script src="firebase-config.js"></script>
    <script src="auth-check.js"></script>
    <script src="user-management.js"></script>
    <script src="offline-manager.js"></script>
</body>

</html>